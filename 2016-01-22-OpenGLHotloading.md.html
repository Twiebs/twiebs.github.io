<!DOCTYPE html><html lang="en-us"><meta charset="UTF-8"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>2016-01-22-OpenGLHotloading</title><meta name="description" content="Torin wiebelts blog"><link rel="stylesheet" type="text/css" href="style.css"><body><div class="page-header"><h1>2016-01-22-OpenGLHotloading</h1></div><nav class="navbar"><div class="navbar-item-container"><a class="navbar-item" href="index.html">Posts</a><a class="navbar-item" href="projects.html">Projects</a><a class="navbar-item" href="about.html">About</a><a class="navbar-item" href="archive.html">Archive</a></div></nav><div class="content"><p>!title(Hotloading OpenGL Procedures with C preprocessor metaprograming)
</p><p>!date(2016-01-22)

</p><h1>Hotloading OpenGL procedures with C preprocessor metaprograming

</h1><p>One of the important features that I wanted when creating this new iteration of my game engine
Was the ablity to hotload code while the engine is still running.  I wanted this system to be as maximaly flexiable
as possible.  I really wanted to be able to hotload code that contained OpenGL functions.  This is how i accomplished
OpenGL function hotloading in the Venom game engine.

</p><h1>C Preprocessor Metaprograming

</h1><p>The problem is that when the dll containing the game code is realoaded after compilation functions that
exist in the engine's executable will not be avaible to it.  OpenGL functions are loaded in the engine
using the same system that the game code uses to obtain them.

</p><p>The opengl procedures are defined in the file opengl_procedures.h
This is a small example of what that file looks like

</p><div style="background-color:rgba(34,34,34,1);color : rgba(200,200,200,1);font-size : 14px;padding : 10px;"><pre><span style="color:#34495e;">// opengl_procedures.h</span>
...

_(PFNGLGENTEXTURESPROC, glGenTextures)
_(PFNGLTEXSTORAGE2DPROC, glTexStorage2D)
_(PFNGLTEXSTORAGE3DPROC, glTexStorage3D)
_(PFNGLTEXIMAGE2DPROC, glTexImage2D)
_(PFNGLTEXIMAGE3DPROC, glTexImage3D)
_(PFNGLTEXSUBIMAGE2DPROC, glTexSubImage2D)
_(PFNGLTEXSUBIMAGE3DPROC, glTexSubImage3D)

...


</pre></div><p>Using the C preprocessor allows the defintions of the OpenGL functions to be pasted in locations where
they are realevant

</p><div style="background-color:rgba(34,34,34,1);color : rgba(200,200,200,1);font-size : 14px;padding : 10px;"><pre><span style="color:#3498db;">struct</span> <span style="color:#f1c40f;">EngineAPI</span>
{
<span style="color:#e74c3c;">#define</span> _(sig, name) <span style="color:#f1c40f;">sig</span> name;
<span style="color:#e74c3c;">#include</span> <span style="color:#2ecc71;">"opengl_procedures.h"</span>
<span style="color:#e74c3c;">#undef</span> _
};


</pre></div><p>One very important facet of this system is that there is no differentation between how the
OpenGL procedures are called in debug and release builds.  This is acomplished by pasting the OpenGL
procedure list as global variables in the game module

</p><div style="background-color:rgba(34,34,34,1);color : rgba(200,200,200,1);font-size : 14px;padding : 10px;"><pre><span style="color:#34495e;">//The Games Translation Unit</span>
<span style="color:#e74c3c;">#define</span> _(sig, name) <span style="color:#3498db;">static</span> <span style="color:#f1c40f;">sig</span> name;
<span style="color:#e74c3c;">#include</span> <span style="color:#2ecc71;">"opengl_procedures.h"</span>
<span style="color:#e74c3c;">#undef</span> _

<span style="color:#3498db;">extern</span> <span style="color:#2ecc71;">"C"</span>
<span style="color:#f1c40f;">void</span> on_module_load(<span style="color:#f1c40f;">EngineAPI</span> *api)
{
<span style="color:#e74c3c;">#define</span> _(sig,name) name = api-><span style="color:#e74c3c;">##name;</span>
<span style="color:#e74c3c;">#include</span> <span style="color:#2ecc71;">"opengl_procedures.h"</span>
<span style="color:#e74c3c;">#undef</span> _
}

</pre></div><p>With this small amount of code we are able to set the function pointers of our global OpenGL functions
within the game module to the procedures that have been loaded from the platform layers coresponding dynamic
OpenGL library.
</p></div><div class="seperator"></div></body></html>